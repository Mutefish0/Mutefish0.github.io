<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="什么是WebGL？WebGL是一个Javascript API，用来渲染交互式的2D和3D图形。WebGL程序主要由两部分组成：第一部分是由Javascrip语言编写的控制代码，在CPU上运行；第二部分是由GLSL ES(OpenGL ES Shading Language)语言编写的着色器(Shader)代码，它直接在GPU上运行。 WebGL Pipeline渲染在屏幕上的每一个像素点都是经过">
<meta property="og:type" content="article">
<meta property="og:title" content="初探WebGL">
<meta property="og:url" content="http://yoursite.com/2020/02/23/webgl-getting-started/index.html">
<meta property="og:site_name" content="程一凡">
<meta property="og:description" content="什么是WebGL？WebGL是一个Javascript API，用来渲染交互式的2D和3D图形。WebGL程序主要由两部分组成：第一部分是由Javascrip语言编写的控制代码，在CPU上运行；第二部分是由GLSL ES(OpenGL ES Shading Language)语言编写的着色器(Shader)代码，它直接在GPU上运行。 WebGL Pipeline渲染在屏幕上的每一个像素点都是经过">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/webgl-getting-started/pipeline-simplified.png">
<meta property="og:image" content="http://yoursite.com/images/webgl-getting-started/coord.png">
<meta property="og:image" content="http://yoursite.com/images/webgl-getting-started/simple-triangle.png">
<meta property="og:image" content="http://yoursite.com/image/webgl-getting-started/draw-by-index.png">
<meta property="og:image" content="http://yoursite.com/images/webgl-getting-started/draw-a-square.png">
<meta property="og:image" content="http://yoursite.com/images/webgl-getting-started/texture-coord.png">
<meta property="og:image" content="http://yoursite.com/images/webgl-getting-started/draw-with-texture.png">
<meta property="og:image" content="http://yoursite.com/images/webgl-getting-started/cube.gif">
<meta property="og:updated_time" content="2020-02-23T16:52:26.467Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="初探WebGL">
<meta name="twitter:description" content="什么是WebGL？WebGL是一个Javascript API，用来渲染交互式的2D和3D图形。WebGL程序主要由两部分组成：第一部分是由Javascrip语言编写的控制代码，在CPU上运行；第二部分是由GLSL ES(OpenGL ES Shading Language)语言编写的着色器(Shader)代码，它直接在GPU上运行。 WebGL Pipeline渲染在屏幕上的每一个像素点都是经过">
<meta name="twitter:image" content="http://yoursite.com/images/webgl-getting-started/pipeline-simplified.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>初探WebGL</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/mutefish0">项目</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2019/12/19/git-cherry-pick/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/02/23/webgl-getting-started/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/02/23/webgl-getting-started/&text=初探WebGL"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/02/23/webgl-getting-started/&is_video=false&description=初探WebGL"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=初探WebGL&body=Check out this article: http://yoursite.com/2020/02/23/webgl-getting-started/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/02/23/webgl-getting-started/&name=初探WebGL&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是WebGL？"><span class="toc-number">1.</span> <span class="toc-text">什么是WebGL？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebGL-Pipeline"><span class="toc-number">2.</span> <span class="toc-text">WebGL Pipeline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标准设备坐标（Normalized-Device-Coordinate-NDC）"><span class="toc-number">3.</span> <span class="toc-text">标准设备坐标（Normalized Device Coordinate, NDC）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化WebGL"><span class="toc-number">4.</span> <span class="toc-text">初始化WebGL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画一个三角形"><span class="toc-number">5.</span> <span class="toc-text">画一个三角形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画一个正方形"><span class="toc-number">6.</span> <span class="toc-text">画一个正方形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#给正方形添加材质"><span class="toc-number">7.</span> <span class="toc-text">给正方形添加材质</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画一个旋转的木箱"><span class="toc-number">8.</span> <span class="toc-text">画一个旋转的木箱</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        初探WebGL
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">程一凡</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-02-23T03:34:25.000Z" itemprop="datePublished">2020-02-23</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="什么是WebGL？"><a href="#什么是WebGL？" class="headerlink" title="什么是WebGL？"></a>什么是WebGL？</h2><p>WebGL是一个Javascript API，用来渲染交互式的2D和3D图形。WebGL程序主要由两部分组成：第一部分是由Javascrip语言编写的控制代码，在CPU上运行；第二部分是由GLSL ES(OpenGL ES Shading Language)语言编写的着色器(Shader)代码，它直接在GPU上运行。</p>
<h2 id="WebGL-Pipeline"><a href="#WebGL-Pipeline" class="headerlink" title="WebGL Pipeline"></a>WebGL Pipeline</h2><p>渲染在屏幕上的每一个像素点都是经过了一系列的按顺序的步骤处理，这些步骤做成了渲染管线（Pipeline）。<br><img src="/images/webgl-getting-started/pipeline-simplified.png" alt><br>简单解释每个步骤：<br>首先Javascript程序可以准备一系列「顶点」（Vertex）数据。对于每一个顶点，都会进行下面的步骤：</p>
<ul>
<li>「顶点着色器」（Vertex Shader）程序拿到一个顶点，在这里可以很方便高效得对其进行一系列的坐标变换，这些计算主要都是矩阵运算。例如旋转、位移、仿射变换、投影变换等，都是在这里进行计算的。随后输出经变换后的顶点。</li>
<li>「片段着色器」（Fragment Shader）程序负责计算对应该顶点的颜色值，同时根据根据三个顶点组成的三角形，自动插值计算三角形内的颜色值。在这里可以很方便高效地处理纹理材质、阴影计算、光照计算等。</li>
<li>最后将坐标和颜色进行光栅化处理，形成每一个像素点。然后在canvas上渲染出来</li>
</ul>
<h2 id="标准设备坐标（Normalized-Device-Coordinate-NDC）"><a href="#标准设备坐标（Normalized-Device-Coordinate-NDC）" class="headerlink" title="标准设备坐标（Normalized Device Coordinate, NDC）"></a>标准设备坐标（Normalized Device Coordinate, NDC）</h2><p>WebGL期望每次顶点着色器运行后，输出的所有<strong>可见的</strong>顶点都为标准设备坐标。也就是说，顶点的x、y、z坐标都应该在-1.0到1.0之间，超出这个范围的顶点将不可见。<br><img src="/images/webgl-getting-started/coord.png" alt></p>
<p>下面的教程将实现在网页中渲染一个旋转的3D箱子。</p>
<h2 id="初始化WebGL"><a href="#初始化WebGL" class="headerlink" title="初始化WebGL"></a>初始化WebGL</h2><p>创建一个canvas标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span> = <span class="string">"canv"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>获取canvas的WebGL上下文，并检查兼容性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canv"</span>);</span><br><span class="line"><span class="keyword">var</span> gl;</span><br><span class="line"><span class="keyword">var</span> glExtensions;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.WebGLRenderingContext) &#123;</span><br><span class="line">  gl = </span><br><span class="line">    canvas.getContext(<span class="string">"webgl"</span>) || </span><br><span class="line">    canvas.getContext(<span class="string">"experimental-webgl"</span>) || </span><br><span class="line">    canvas.getContext(<span class="string">"moz-webgl"</span>) || </span><br><span class="line">    canvas.getContext(<span class="string">"webkit-3d"</span>);</span><br><span class="line">  <span class="keyword">if</span> (gl) &#123;</span><br><span class="line">    gl.viewportWidth = canvas.width;</span><br><span class="line">    gl.viewportHeight = canvas.height;</span><br><span class="line">    glExtensions = gl.getSupportedExtensions();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"WebGL功能被关闭"</span>);</span><br><span class="line">    alert(<span class="string">"WebGL功能被关闭"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"当前浏览器不支持WebGL"</span>);</span><br><span class="line">  alert(<span class="string">"当前浏览器不支持WebGL"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="画一个三角形"><a href="#画一个三角形" class="headerlink" title="画一个三角形"></a>画一个三角形</h2><p>写一个简单的顶点着色器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 顶点着色器源代码，坐标不变</span></span><br><span class="line"><span class="comment">// 齐次向量w为1.0（w用于“透视除法”，即x、y、x分别处以w，这个操作会在顶点着色器最后阶段自动执行）</span></span><br><span class="line"><span class="keyword">var</span> vertexShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec3 a_Pos;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_Position = vec4(a_Pos.x, a_Pos.y, a_Pos.z, 1.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>写一个简单的片段着色器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 片段着色器源代码，固定输出绿色</span></span><br><span class="line"><span class="keyword">var</span> fragShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_FragColor = vec4(0.0, 0.5, 0.0, 1.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>创建顶点着色器和片段着色器并编译</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shader_vs = gl.createShader(gl.VERTEX_SHADER);</span><br><span class="line"><span class="keyword">var</span> shader_frag = gl.createShader(gl.FRAGMENT_SHADER);</span><br><span class="line">gl.shaderSource(shader_vs, vertexShaderSource);</span><br><span class="line">gl.shaderSource(shader_frag, fragShaderSource);</span><br><span class="line"><span class="comment">// 编译着色器源代码</span></span><br><span class="line">gl.compileShader(shader_vs);</span><br><span class="line">gl.compileShader(shader_frag);</span><br><span class="line"><span class="comment">// 检查编译错误</span></span><br><span class="line"><span class="keyword">if</span> (!gl.getShaderParameter(shader_vs, gl.COMPILE_STATUS)) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"顶点着色器编译出错"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!gl.getShaderParameter(shader_frag, gl.COMPILE_STATUS)) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"片段着色器编译出错"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个程序，并将顶点着色器和片段着色器链接到一起</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> program = gl.createProgram();</span><br><span class="line">gl.attachShader(program, shader_vs);</span><br><span class="line">gl.attachShader(program, shader_frag);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> linkError = gl.linkProgram(program);</span><br><span class="line"><span class="keyword">if</span> (linkError) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(linkError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，着色器程序创建完成了。现在创建一块内存，把顶点数据存进去</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一块buffer内存来存储数据</span></span><br><span class="line"><span class="keyword">var</span> vertexbuffer = gl.createBuffer();</span><br><span class="line"><span class="comment">// 把gl.ARRAY_BUFFER绑定到vertexbuffer</span></span><br><span class="line">gl.bindBuffer(gl.ARRAY_BUFFER, vertexbuffer);</span><br><span class="line"><span class="comment">// 把顶点数据送进buffer</span></span><br><span class="line">gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">   <span class="number">-0.0</span>, <span class="number">0.5</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0.0</span></span><br><span class="line">]), gl.STATIC_DRAW);</span><br></pre></td></tr></table></figure>

<p>激活上面创建好的着色器程序，并定义数据结构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gl.useProgram(program);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> aPosLocation = gl.getAttribLocation(program, <span class="string">"a_Pos"</span>);</span><br><span class="line"><span class="comment">// 属性为“a_Pos”，分量为3，类型FLOAT（4个字节）,不归一化，间隔0个字节，偏移0字节</span></span><br><span class="line">gl.vertexAttribPointer(aPosLocation, <span class="number">3</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">gl.enableVertexAttribArray(aPosLocation);</span><br></pre></td></tr></table></figure>

<p>最后画出三角形</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用黑色背景填充屏幕</span></span><br><span class="line">gl.clearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class="line"><span class="comment">// 画三角形</span></span><br><span class="line">gl.drawArrays(gl.TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>结果如图：<br><img src="/images/webgl-getting-started/simple-triangle.png" alt></p>
<h2 id="画一个正方形"><a href="#画一个正方形" class="headerlink" title="画一个正方形"></a>画一个正方形</h2><p>如果按照上面的方法，画一个正方形，需要使用6个顶点（画2个三角形），这样就多存储了两个冗余的顶点数据。<br>为解决这个问题，WebGL支持通过按照索引来处理顶点数据，这样就只需4个顶点数据就够了<br><img src="/image/webgl-getting-started/draw-by-index.png" alt><br>额外创建一个对应gl.ELEMENT_ARRAY_BUFFER的buffer，来存储索引</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vertics = [</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0.0</span>,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> indics = [</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> vertexBuffer = gl.createBuffer();</span><br><span class="line">gl.bindBuffer(gl.ARRAY_BUFFER, vertexbuffer);</span><br><span class="line">gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(vertics), gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexBuffer = gl.createBuffer();</span><br><span class="line">gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer)</span><br><span class="line">gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Uint16Array</span>(indics), gl.STATIC_DRAW);</span><br></pre></td></tr></table></figure>

<p>使用gl.drawElements来绘制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);</span><br></pre></td></tr></table></figure>

<p>结果如下<br><img src="/images/webgl-getting-started/draw-a-square.png" alt></p>
<h2 id="给正方形添加材质"><a href="#给正方形添加材质" class="headerlink" title="给正方形添加材质"></a>给正方形添加材质</h2><p>创建材质（Texture）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> texture = gl.createTexture();</span><br><span class="line">gl.bindTexture(gl.TEXTURE_2D, texture);</span><br><span class="line">gl.activeTexture(gl.TEXTURE0);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片不重复，采取编译拉伸的方式</span></span><br><span class="line">gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);</span><br><span class="line">gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);</span><br><span class="line"><span class="comment">// 图片缩放采用线性过滤</span></span><br><span class="line">gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);</span><br><span class="line"><span class="comment">// 加载图片，并传送图片数据</span></span><br><span class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  gl.texImage2D(gl.TEXTURE_2D, <span class="number">0</span>, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);</span><br><span class="line">&#125;</span><br><span class="line">image.src = <span class="string">"./box.png"</span>;</span><br></pre></td></tr></table></figure>

<p>顶点着色器和片段着色器程序</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把材质坐标传给片段着色器</span></span><br><span class="line"><span class="keyword">var</span> vertexShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec3 a_Pos;</span></span><br><span class="line"><span class="string">  attribute vec2 tex_Coord;</span></span><br><span class="line"><span class="string">  varying highp vec2 f_tex_Coord;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    f_tex_Coord = tex_Coord;</span></span><br><span class="line"><span class="string">    gl_Position = vec4(a_Pos.x, a_Pos.y, a_Pos.z, 1.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过材质插值得到颜色</span></span><br><span class="line"><span class="keyword">var</span> fragShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  uniform sampler2D u_Texture;</span></span><br><span class="line"><span class="string">  varying highp vec2 f_tex_Coord;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_FragColor = texture2D(u_Texture, f_tex_Coord);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>在WebGL里，材质坐标(0, 0)对应图片左下角，(0, 1)对应图片左上角，(1, 0)对应图片右下角，（1，1）对应图片的右上角<br><img src="/images/webgl-getting-started/texture-coord.png" alt><br>我们这次同时存储顶点数据和材质坐标数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vertics = [</span><br><span class="line">  <span class="comment">// vertex          // texture coords</span></span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">0.0</span>,    <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.0</span>,     <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.0</span>,   <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0.0</span>,    <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>激活程序后，把材质绑定到第0个单元</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把材质绑定到第0个单元</span></span><br><span class="line"><span class="keyword">var</span> samplerLocation = gl.getUniformLocation(program, <span class="string">"u_Texture"</span>);</span><br><span class="line">gl.uniform1i(samplerLocation, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>同时重新定义数据格式，这次步长为20个字节（5 * 4，一个Float32占四个字节），顶点数据的偏移为0，材质坐标的偏移位12个字节（3 * 4）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aPosLocation = gl.getAttribLocation(program, <span class="string">"a_Pos"</span>);</span><br><span class="line">gl.vertexAttribPointer(aPosLocation, <span class="number">3</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">4</span> * <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">gl.enableVertexAttribArray(aPosLocation);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> texCoordLocation = gl.getAttribLocation(program, <span class="string">"tex_Coord"</span>);</span><br><span class="line">gl.vertexAttribPointer(texCoordLocation, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">4</span> * <span class="number">5</span>, <span class="number">4</span> * <span class="number">3</span>);</span><br><span class="line">gl.enableVertexAttribArray(texCoordLocation);</span><br></pre></td></tr></table></figure>

<p>最后画出来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 用黑色背景填充屏幕</span></span><br><span class="line">  gl.clearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">  gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class="line">  <span class="comment">// 画一个正方形</span></span><br><span class="line">  gl.drawElements(gl.TRIANGLES, <span class="number">6</span>, gl.UNSIGNED_SHORT, <span class="number">0</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>结果如下<br><img src="/images/webgl-getting-started/draw-with-texture.png" alt></p>
<h2 id="画一个旋转的木箱"><a href="#画一个旋转的木箱" class="headerlink" title="画一个旋转的木箱"></a>画一个旋转的木箱</h2><p>定点数据，一共需要画6个面，每个面4个顶点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vertics = [</span><br><span class="line">  <span class="comment">// 后面</span></span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>,      <span class="number">0.0</span>, <span class="number">1.0</span>,   </span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>,       <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>,     <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>,      <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="comment">// 前面</span></span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>,      <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>,       <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>,     <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>,      <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="comment">// 左面</span></span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>,      <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>,       <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>,     <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>,      <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="comment">// 右面</span></span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>,      <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>,       <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>,     <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>,      <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="comment">// 下面</span></span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>,     <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>,      <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>,    <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>,     <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="comment">// 上面</span></span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>,      <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>,       <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">  <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>,     <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>,      <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line"></span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> indics = [</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">  <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>,</span><br><span class="line">  <span class="number">10</span>, <span class="number">9</span>, <span class="number">11</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>,</span><br><span class="line">  <span class="number">14</span>, <span class="number">13</span>, <span class="number">15</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>,</span><br><span class="line">  <span class="number">18</span>, <span class="number">17</span>, <span class="number">19</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>,</span><br><span class="line">  <span class="number">22</span>, <span class="number">21</span>, <span class="number">23</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>修改顶点着色器代码，进行矩阵运算</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vertexShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec3 a_Pos;</span></span><br><span class="line"><span class="string">  attribute vec2 tex_Coord;</span></span><br><span class="line"><span class="string">  uniform mat4 translation;</span></span><br><span class="line"><span class="string">  uniform mat4 rotation_x;</span></span><br><span class="line"><span class="string">  uniform mat4 rotation_y;</span></span><br><span class="line"><span class="string">  uniform mat4 projection;</span></span><br><span class="line"><span class="string">  varying highp vec2 f_tex_Coord;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    f_tex_Coord = tex_Coord;</span></span><br><span class="line"><span class="string">    gl_Position = projection * translation * rotation_y * rotation_x * vec4(a_Pos, 1.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>开启Z缓冲，不然可以看到背面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gl.enable(gl.DEPTH_TEST);</span><br></pre></td></tr></table></figure>

<p>定义一系列uniform，可以在运行过程中，通过js实时传递给着色器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> translationLocation = gl.getUniformLocation(program, <span class="string">"translation"</span>);</span><br><span class="line"><span class="keyword">var</span> rotationXLocation = gl.getUniformLocation(program, <span class="string">"rotation_x"</span>);</span><br><span class="line"><span class="keyword">var</span> rotationYLocation = gl.getUniformLocation(program, <span class="string">"rotation_y"</span>);</span><br><span class="line"><span class="keyword">var</span> projectionLocation = gl.getUniformLocation(program, <span class="string">"projection"</span>);</span><br></pre></td></tr></table></figure>

<p>设置一系列工具函数，来进行坐标变换，这里涉及到一些线性代数和3D图形学的知识。具体可以查看<br><a href="https://learnopengl-cn.github.io/01%20Getting%20started/08%20Coordinate%20Systems/" target="_blank" rel="noopener">参考资料</a><br>代码实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 平移变换</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTranslate</span>(<span class="params">dx, dy, dz</span>) </span>&#123;</span><br><span class="line">  gl.uniformMatrix4fv(translationLocation, <span class="literal">false</span>, [</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">    dx, dy, dz, <span class="number">1</span>,</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绕x轴旋转</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setRotateXDeg</span>(<span class="params">rotateXDeg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rotateX = rotateXDeg / <span class="number">180</span> * <span class="built_in">Math</span>.PI;</span><br><span class="line">  gl.uniformMatrix4fv(rotationXLocation, <span class="literal">false</span>, [</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="built_in">Math</span>.cos(rotateX), -<span class="built_in">Math</span>.sin(rotateX), <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="built_in">Math</span>.sin(rotateX), <span class="built_in">Math</span>.cos(rotateX), <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绕y轴旋转</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setRotateYDeg</span>(<span class="params">rotateYDeg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rotateY = rotateYDeg / <span class="number">180</span> * <span class="built_in">Math</span>.PI;</span><br><span class="line">  gl.uniformMatrix4fv(rotationYLocation, <span class="literal">false</span>, [</span><br><span class="line">    <span class="built_in">Math</span>.cos(rotateY), <span class="number">0</span>, <span class="built_in">Math</span>.sin(rotateY), <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    -<span class="built_in">Math</span>.sin(rotateY), <span class="number">0</span>, <span class="built_in">Math</span>.cos(rotateY), <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 透视变换</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setProjection</span>(<span class="params">near, far, fov, aspectRatio</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> f = <span class="number">1.0</span> / <span class="built_in">Math</span>.tan(fov / <span class="number">180</span> * <span class="built_in">Math</span>.PI / <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">var</span> rangeInv = <span class="number">1</span> / (near - far);</span><br><span class="line"></span><br><span class="line">  gl.uniformMatrix4fv(projectionLocation, <span class="literal">false</span>, [</span><br><span class="line">    f / aspectRatio, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, f, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, (near + far) * rangeInv, <span class="number">-1</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, near * far * rangeInv * <span class="number">2</span>, <span class="number">0</span></span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置好初始参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setTranslate(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-4</span>);</span><br><span class="line">setRotateXDeg(<span class="number">45</span>);</span><br><span class="line">setRotateYDeg(<span class="number">45</span>);</span><br><span class="line">setProjection(<span class="number">0.1</span>, <span class="number">50.0</span>, <span class="number">45</span>, <span class="number">0.75</span>);</span><br></pre></td></tr></table></figure>

<p>通过requestAnimationFrame来进行实时渲染，并统计FPS</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统计FPS</span></span><br><span class="line"><span class="keyword">var</span> frameCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> fpsEl = <span class="built_in">document</span>.getElementById(<span class="string">"fps"</span>);</span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  fpsEl.innerText = <span class="string">"FPS: "</span> + frameCount;</span><br><span class="line">  frameCount = <span class="number">0</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">frameStep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 用黑色背景填充屏幕</span></span><br><span class="line">  gl.clearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">  gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class="line">  <span class="comment">// 画一个立方体</span></span><br><span class="line">  gl.drawElements(gl.TRIANGLES, <span class="number">36</span>, gl.UNSIGNED_SHORT, <span class="number">0</span>);</span><br><span class="line">  frameCount += <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">window</span>.requestAnimationFrame(frameStep);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转木箱</span></span><br><span class="line"><span class="keyword">var</span> r = <span class="number">0</span>;</span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  r += <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (r == <span class="number">360</span>) &#123;</span><br><span class="line">    r = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  setRotateXDeg(r);</span><br><span class="line">  setRotateYDeg(r);</span><br><span class="line">&#125;, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.requestAnimationFrame(frameStep);</span><br></pre></td></tr></table></figure>

<p>效果图：<br><img src="/images/webgl-getting-started/cube.gif" alt><br>附上完整的<a href="https://github.com/Mutefish0/webgl-getting-started" target="_blank" rel="noopener">源代码</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/mutefish0">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是WebGL？"><span class="toc-number">1.</span> <span class="toc-text">什么是WebGL？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebGL-Pipeline"><span class="toc-number">2.</span> <span class="toc-text">WebGL Pipeline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标准设备坐标（Normalized-Device-Coordinate-NDC）"><span class="toc-number">3.</span> <span class="toc-text">标准设备坐标（Normalized Device Coordinate, NDC）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化WebGL"><span class="toc-number">4.</span> <span class="toc-text">初始化WebGL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画一个三角形"><span class="toc-number">5.</span> <span class="toc-text">画一个三角形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画一个正方形"><span class="toc-number">6.</span> <span class="toc-text">画一个正方形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#给正方形添加材质"><span class="toc-number">7.</span> <span class="toc-text">给正方形添加材质</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画一个旋转的木箱"><span class="toc-number">8.</span> <span class="toc-text">画一个旋转的木箱</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/02/23/webgl-getting-started/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/02/23/webgl-getting-started/&text=初探WebGL"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/02/23/webgl-getting-started/&is_video=false&description=初探WebGL"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=初探WebGL&body=Check out this article: http://yoursite.com/2020/02/23/webgl-getting-started/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/02/23/webgl-getting-started/&title=初探WebGL"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/02/23/webgl-getting-started/&name=初探WebGL&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Ivancing
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/mutefish0">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-146722305-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
